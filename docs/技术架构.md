è¿™ä»½è¯¦ç»†è®¾è®¡æŠ¥å‘Šå°†ä¸Šè¿°æ–¹æ¡ˆè½¬åŒ–ä¸ºå¯è½åœ°æ‰§è¡Œçš„æŠ€æœ¯æ¶æ„ã€‚æˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨å¦‚ä½•é€šè¿‡ **â€œçŸ¥è¯†å›¾è°± + LLMâ€** é—­ç¯å®ç°è‡ªç„¶è¯­è¨€åˆ° **SpEL** çš„è½¬åŒ–ã€‚

---

## 1. æŠ€æœ¯æ ˆä¸ç»„ä»¶ç‰ˆæœ¬

| ç»„ä»¶ | æ¨èç‰ˆæœ¬ | è¯´æ˜ |
| --- | --- | --- |
| **å‰ç«¯ (React)** | 18.2.x + TailwindCSS | UI æ¡†æ¶ï¼Œåˆ©ç”¨ Ant Design (Pro) æé«˜æ•ˆç‡ |
| **åç«¯ (SpringBoot)** | 3.2.x | æ ¸å¿ƒå¾®æœåŠ¡æ¡†æ¶ï¼Œå†…ç½® SpEL è§£æå†…æ ¸ |
| **å›¾æ•°æ®åº“ (Neo4j)** | 5.12.x (Community/Enterprise) | å­˜å‚¨æœ¬ä½“äº”å…ƒç»„åŠè§„åˆ™å…³ç³» |
| **LLM** | GPT-4o / Claude 3.5 / DeepSeek-V3 | è´Ÿè´£ä»£ç è§£æä¸ NL2SpEL ç”Ÿæˆ |


---

## 2. åŠŸèƒ½æ¨¡å—ä¸ç•Œé¢å…ƒç´ è®¾è®¡

### 2.1 æºç çŸ¥è¯†æå–æ¨¡å— (Source-to-KG)

* **åŠŸèƒ½ç‚¹**ï¼šä¸Šä¼  Java æºç ï¼Œè‡ªåŠ¨è¯†åˆ«ç‰©ç†å­—æ®µã€äº§å“ ID åŠé€»è¾‘å…³ç³»ã€‚
* **ç•Œé¢å…ƒç´ **ï¼šæºç ä¸Šä¼ åŒºã€è§£æè¿›åº¦æ¡ã€çŸ¥è¯†ç‚¹é¢„è§ˆè¡¨æ ¼ï¼ˆåŒ…å«æå–çš„ç‰©ç† IDã€ä¸šåŠ¡å«ä¹‰ã€å»ºè®®æ˜ å°„å…³ç³»ï¼‰ã€‚
* **æ¥å£**ï¼š`POST /api/v1/ontology/extract`

### 2.2 è§„åˆ™ç”Ÿæˆå·¥ä½œå° (NL2SpEL Workbench)

* **åŠŸèƒ½ç‚¹**ï¼šè‡ªç„¶è¯­è¨€è¾“å…¥ã€SpEL å®æ—¶ç”Ÿæˆã€è¯­ä¹‰å¯¹é½çº é”™ã€‚
* **ç•Œé¢å…ƒç´ **ï¼š
* **å·¦ä¾§**ï¼šå¯¹è¯æ¡†ï¼ˆè¾“å…¥ NL éœ€æ±‚ï¼‰ã€‚
* **ä¸­é—´**ï¼šSpEL ç¼–è¾‘å™¨ï¼ˆåªè¯»ï¼Œå®æ—¶æ˜¾ç¤ºç”Ÿæˆçš„ä»£ç ï¼‰ã€‚
* **å³ä¾§**ï¼šæœ¬ä½“å›¾è°±é¢„è§ˆï¼ˆæ˜¾ç¤ºå½“å‰éœ€æ±‚å…³è”çš„ Product å’Œ Metadata èŠ‚ç‚¹ï¼‰ã€‚


* **æ¥å£**ï¼š`POST /api/v1/rule/generate`

### 2.3 ä»¿çœŸéªŒè¯ä¸å‘å¸ƒæ¨¡å— (Sandbox & Deployment)

* **åŠŸèƒ½ç‚¹**ï¼šæ„é€  Mock æ•°æ®ï¼Œæ‰§è¡Œ SpELï¼Œæ¯”å¯¹é¢„æœŸç»“æœã€‚
* **ç•Œé¢å…ƒç´ **ï¼šä¸Šä¸‹æ–‡å˜é‡å½•å…¥åŒºï¼ˆJSONï¼‰ã€è¿è¡Œç»“æœé¢æ¿ï¼ˆPass/Failï¼‰ã€æ—¥å¿—æ§åˆ¶å°ã€‚
* **æ¥å£**ï¼š`POST /api/v1/rule/test`

---

## 3. å‰åç«¯æ¥å£äº¤äº’è®¾è®¡ (API Contract)

### 3.1 è§„åˆ™ç”Ÿæˆæµç¨‹

1. **Request**: `POST /api/v1/rule/generate`
```json
{
  "productId": "80000122",
  "naturalLanguage": "å½“ä¸šåŠ¡ç±»å‹æ˜¯èåˆå…‰ç½‘æ—¶ï¼Œåªå‡†åšæ‹†æœºæ“ä½œ",
  "context": "AccessProdInst"
}

```


2. **Server Process**:
* æŸ¥è¯¢ Neo4j è·å– `80000122` çš„ Metadata (col1 -> ywlx)ã€‚
* ç»„è£… Prompt å‘é€ç»™ LLMã€‚
* æ ¡éªŒ SpEL è¯­æ³•ã€‚


3. **Response**:
```json
{
  "spel": "#getAttr('col1') == '3' ? #serviceOfferId == '2831' : true",
  "explanation": "å·²è¯†åˆ«ä¸šåŠ¡ç±»å‹ä¸ºcol1ï¼Œèåˆå…‰ç½‘å€¼ä¸º3ï¼Œæ‹†æœºåŠ¨ä½œä¸º2831",
  "confidence": 0.98
}

```



---

## 4. æ ¸å¿ƒæç¤ºè¯å·¥ç¨‹ (Prompt Engineering)

### 4.1 æºç è§£ææç¤ºè¯ (Java -> KG)

> **Role**: ä½ æ˜¯ä¸€ä¸ªä¸“å®¶çº§æ¶æ„å¸ˆï¼Œæ“…é•¿åˆ†æ BSS ç³»ç»Ÿæ—§ä»£ç ã€‚
> **Input**: Java æºä»£ç ã€‚
> **Task**:
> 1. æå–æ‰€æœ‰çš„äº§å“ ID å’Œä¸šåŠ¡æ“ä½œç  (OfferId)ã€‚
> 2. è¯†åˆ«æ‰€æœ‰ `getAttr()` çš„å‚æ•°å¹¶æ¨æµ‹å…¶ä¸šåŠ¡å«ä¹‰ï¼ˆå¦‚ col1 ä»£è¡¨ä¸šåŠ¡ç±»å‹ï¼‰ã€‚
> 3. è¾“å‡ºæœ¬ä½“äº”å…ƒç»„ JSONï¼š`{ "concepts": [], "relations": [], "logic": [] }`ã€‚
> 
> 

### 4.2 NL2SpEL ç”Ÿæˆæç¤ºè¯ (NL + KG -> SpEL)

> **Role**: ä½ æ˜¯ä¸€ä¸ªè§„åˆ™å¼•æ“ç¿»è¯‘å™¨ã€‚
> **Context**:
> * æœ¬ä½“çŸ¥è¯†åº“ï¼š{ "col1": "ä¸šåŠ¡ç±»å‹", "3": "èåˆå…‰ç½‘", "2831": "æ‹†æœº" }
> * å½“å‰äº§å“ï¼šçµçŠ€ä¸“çº¿ (80000122)
> **Task**: å°†éœ€æ±‚â€œèåˆå…‰ç½‘åªå‡†æ‹†æœºâ€è½¬åŒ–ä¸º Spring ELã€‚
> **Rule**:
> * ä½¿ç”¨ `#getAttr('col1')` è·å–å±æ€§ã€‚
> * å¿…é¡»ä¿è¯ç”Ÿæˆçš„è¡¨è¾¾å¼é€»è¾‘é—­ç¯ã€‚
> * è¿”å›æ ¼å¼ï¼š`SpEL: [code]`ã€‚
> 
> 

---

## 5. é¢„ç½®æ•°æ®è®¾è®¡ (Neo4j æœ¬ä½“äº”å…ƒç»„)

åœ¨ç³»ç»Ÿä¸­é¢„ç½®ä»¥ä¸‹æ ¸å¿ƒæ¨¡å‹æ•°æ®ï¼š

```cypher
// æ¦‚å¿µå»ºæ¨¡ (C)
CREATE (p:Concept {name: 'Product', desc: 'ä¸šåŠ¡äº§å“'})
CREATE (m:Concept {name: 'Metadata', desc: 'ç‰©ç†å­—æ®µæ˜ å°„'})

// å®ä¾‹æ•°æ® (I)
CREATE (lx:Product {id: '80000122', name: 'çµçŠ€ä¸“çº¿'})
CREATE (c1:Metadata {id: 'col1', name: 'ä¸šåŠ¡ç±»å‹', mapping: 'ywlx'})

// å…³ç³»å»ºæ¨¡ (R)
CREATE (c1)-[:BELONGS_TO]->(lx)

// å‡½æ•°/ç®—å­å»ºæ¨¡ (F)
CREATE (f:Function {name: 'ipCheck', signature: '@ipUtil.isValid(#val)'})

```

---

## 6. ç³»ç»Ÿè¯¦ç»†è®¾è®¡æ¶æ„å›¾

```mermaid
graph LR
    subgraph "å‰ç«¯ (React)"
        UI[è§„åˆ™é…ç½®é—¨æˆ·] --> Editor[NL ç¼–è¾‘å™¨]
        Editor --> Graph[å›¾è°±å¯è§†åŒ–]
    end

    subgraph "åç«¯ (SpringBoot)"
        API[REST æ§åˆ¶å™¨] --> LLM_S[LLM é€‚é…å™¨]
        API --> KG_S[Neo4j ä¸šåŠ¡ç»„ä»¶]
        API --> Eval[SpEL æ‰§è¡Œå™¨]
        
        LLM_S -- "æ£€ç´¢æ˜ å°„" --> KG_S
        KG_S -- "æŒä¹…åŒ–" --> Neo4j[(Neo4j DB)]
    end

    subgraph "æ‰§è¡Œå†…æ ¸"
        Eval -- "Mock æ•°æ®" --> Sandbox[ä»¿çœŸæ²™ç®±]
        Sandbox -- "åå‘ç¿»è¯‘" --> UI
    end

```

---

## 7. å…³é”®ä»£ç ç‰‡æ®µå®ç° (SpringBoot)

### SpEL è§£æä¸éªŒè¯ç»„ä»¶

```java
@Service
public class SpelValidationService {
    private final ExpressionParser parser = new SpelExpressionParser();

    public boolean validate(String spel, Map<String, Object> context) {
        try {
            StandardEvaluationContext evalContext = new StandardEvaluationContext();
            evalContext.setVariables(context);
            Expression exp = parser.parseExpression(spel);
            exp.getValue(evalContext); // è¯•è¿è¡Œ
            return true;
        } catch (Exception e) {
            log.error("SpEL è¯­æ³•é”™è¯¯: {}", e.getMessage());
            return false;
        }
    }
}

```

### Neo4j æ˜ å°„æŸ¥è¯¢

```java
@Repository
public interface MetadataRepository extends Neo4jRepository<MetadataEntity, String> {
    @Query("MATCH (m:Metadata)-[:BELONGS_TO]->(p:Product {id: $prodId}) RETURN m")
    List<MetadataEntity> findByProductId(String prodId);
}

```

---

### ğŸ’¡ æ ¸å¿ƒä»·å€¼æ€»ç»“

è¯¥è®¾è®¡é€šè¿‡ **Neo4j é”æ­»ç‰©ç†ä¸ä¸šåŠ¡çš„æ˜ å°„å…³ç³»**ï¼Œé˜²æ­¢ LLM åœ¨ç”Ÿæˆ SpEL æ—¶äº§ç”Ÿâ€œå¹»è§‰â€ï¼ˆå³ç”Ÿæˆä¸å­˜åœ¨çš„å­—æ®µåï¼‰ã€‚åŒæ—¶ï¼Œåˆ©ç”¨ React å‰ç«¯å°†å¤æ‚çš„é€»è¾‘éªŒè¯å¯è§†åŒ–ï¼Œç¡®ä¿éæŠ€æœ¯äººå‘˜ç”Ÿæˆçš„è§„åˆ™æ˜¯**èƒ½ç”Ÿæˆã€å¯éªŒè¯ã€å¯ç®¡ç†**çš„ã€‚
